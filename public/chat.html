<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>One-to-One Chat</title>
    <script src="/socket.io/socket.io.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qs/6.12.1/qs.min.js" integrity="sha512-vuLOE4Fh9lfxaN9n81Vl1HwrqMYz9WKoNmsHNC7Hz7OWX4k4O7FjCyQ1tQ82RJExao+Fas40RLiS5PCfVRGgnQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
</head>
<style>
    body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 0;
    height: 100vh;
    display: flex;
    flex-direction: column;
}

header {
    background-color: #075e54;
    color: white;
    padding: 10px;
    text-align: center;
}

.chat-container {
    flex-grow: 1;
    display: flex;
    flex-direction: column;
    max-width: 800px;
    margin: 0 auto;
    border: 1px solid #ddd;
}

.chat-messages {
    flex-grow: 1;
    overflow-y: auto;
    padding: 20px;
    display: flex;
    flex-direction: column;
}

.message {
    max-width: 70%;
    padding: 10px;
    margin: 5px 0;
    border-radius: 10px;
    line-height: 1.4;
}

.sent {
    align-self: flex-end;
    background-color: #dcf8c6;
}

.received {
    align-self: flex-start;
    background-color: #fff;
}

.input-area {
    display: flex;
    padding: 10px;
    background-color: #f0f0f0;
}

.input-area form {
    display: flex;
    width: 100%;
}

#message-input {
    flex-grow: 1;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 20px;
}

#send-button {
    background-color: #075e54;
    color: white;
    border: none;
    padding: 10px 20px;
    margin-left: 10px;
    border-radius: 20px;
    cursor: pointer;
}
</style>
<body>
    <div class="chat-container">
        <header class="chat-header">
          <h1> ChatConnect</h1>
          <a href="index.html" class="btn">Leave Room</a>
        </header>
        <main class="chat-main">
          <div class="chat-sidebar">
            <h4>Active Users :</h4>
            <ul id="users">
            </ul>
          </div>
          <div class="chat-messages">
                        <div class="chat-container">
              </div>
                        </div>
          </div>
        </main>
        <div class="chat-form-container">
          <form id="chat-form">
            <input
              id="msg"
              type="text"
              placeholder="Enter Message"
              required
              autocomplete="off">
            <button class="btn"><i class="fas fa-paper-plane"></i></button>
          </form>
        </div>
      </div>
      </body>
      <script src="/socket.io/socket.io.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/qs/6.12.1/qs.min.js" integrity="sha512-vuLOE4Fh9lfxaN9n81Vl1HwrqMYz9WKoNmsHNC7Hz7OWX4k4O7FjCyQ1tQ82RJExao+Fas40RLiS5PCfVRGgnQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>


<script>
const socket=io();
let data=''
const {username,room}=Qs.parse(location.search,{
    ignoreQueryPrefix:true
});

socket.emit('user-name',username)
const chatmsg=document.querySelector('.chat-messages')
document.getElementById('chat-form').addEventListener('submit',(e)=>{
    e.preventDefault();
    //console.log('event trigger')
     data=document.getElementById("msg").value
     socket.emit('ok',data);
     //Clearing the input
     document.getElementById("msg").value=''
     document.getElementById("msg").focus()
})
function getUniqueElements(users_all) {
    return users_all.filter((value, index, self) => self.indexOf(value) === index);
}
let i=0;
const users_all=[]
socket.on('show-all-users',users=>{
    users_all.push(...users);
    const uniqueUsers = getUniqueElements(users_all);
    const user_list = document.getElementById('users');
    user_list.innerHTML = uniqueUsers.map(user => `<li>${user}</li>`).join('');
})
    
socket.on('show-msg',msg=>{
    if(msg.username){
    document.querySelector('.chat-messages').innerHTML=
    document.querySelector('.chat-messages').innerHTML+`<div style="display: flex; flex-direction: column; background-color: #4a4a4a; color: #ffffff; padding: 8px; border-radius: 5px; margin: 10px 0; z-index: auto;">
    <p style="font-size: 9px; margin: 0 0 3px;color: #ffcc00;">${msg.username}</p>
    <p style="margin: 0 0 3px;font-size: 13px;">${msg.text}</p>
    <p style="font-size: 8px; margin: 0; text-align: right;">${msg.time}</p></div>`;
    }
    chatmsg.scrollTop=chatmsg.scrollHeight;
})

document.querySelector('.btn').addEventListener('click',()=>{
    socket.emit('disconnected', `${username} has disconnected!`);
users_all = users_all.filter(el => el !== username);
})

</script>


